<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinterest x Instagram Hybrid</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #fafafa; /* Instagram background */
        }
        /* Hide scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Masonry Grid (Pinterest Style) */
        .masonry-grid {
            column-count: 2;
            column-gap: 16px;
        }
        @media (min-width: 768px) { .masonry-grid { column-count: 3; } }
        @media (min-width: 1024px) { .masonry-grid { column-count: 4; } }
        
        .break-inside-avoid { break-inside: avoid; }

        /* Story Circle Gradient (Instagram Style) */
        .story-gradient {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            padding: 2px;
        }

        /* Dropdown Simple Style */
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 12px;
            z-index: 100;
            min-width: 150px;
            padding: 8px 0;
        }
        .dropdown-menu.active { display: block; }

        /* Instagram Post Style */
        .insta-card {
            background: white;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            margin-bottom: 24px;
        }
    </style>
</head>
<body class="text-gray-900" onclick="hideAllDropdowns()">

    <!-- Side Navigation (Pinterest Style) -->
    <aside class="w-20 fixed h-full flex flex-col items-center py-6 bg-white z-50 border-r border-gray-200">
        <div class="mb-8 cursor-pointer hover:bg-gray-100 p-3 rounded-full transition" onclick="closeBoard()">
            <i class="fa-brands fa-pinterest text-red-600 text-3xl"></i>
        </div>
        <nav class="flex flex-col gap-8 w-full items-center">
            <a href="#" onclick="closeBoard()" class="p-3 rounded-full hover:bg-gray-100 transition text-gray-900"><i class="fa-solid fa-house text-xl"></i></a>
            <a href="#" class="p-3 rounded-full hover:bg-gray-100 transition text-gray-500"><i class="fa-solid fa-magnifying-glass text-xl"></i></a>
            <a href="#" onclick="openCreateBoardModal()" class="p-3 rounded-full hover:bg-gray-100 transition text-gray-500"><i class="fa-solid fa-plus text-xl"></i></a>
            <a href="#" class="p-3 rounded-full hover:bg-gray-100 transition text-gray-500"><i class="fa-solid fa-play text-xl"></i></a> <!-- Reels icon -->
            <a href="#" class="p-3 rounded-full hover:bg-gray-100 transition text-gray-500"><i class="fa-solid fa-heart text-xl"></i></a>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 ml-20 relative">
        
        <!-- Top Header -->
        <header class="sticky top-0 bg-white z-40 py-3 px-6 flex items-center justify-between border-b border-gray-200">
            <div class="text-2xl font-bold tracking-tighter italic">Instagram</div> <!-- Instagram Logo Text Style -->
            <div class="flex-1 max-w-xl mx-auto px-4 hidden md:block">
                <div class="relative w-full">
                    <input type="text" class="w-full bg-gray-100 rounded-lg py-2 pl-10 pr-4 focus:outline-none" placeholder="Search">
                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-gray-400 text-sm"></i>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <i onclick="openCreateStoryModal()" class="fa-regular fa-square-plus text-2xl cursor-pointer hover:text-gray-600 transition"></i>
                <i class="fa-regular fa-paper-plane text-2xl cursor-pointer"></i>
            </div>
        </header>

        <!-- ================= HOME VIEW (Pinterest Grid with Instagram Stories) ================= -->
        <div id="home-view" class="block">
            
            <!-- Stories Bar (Instagram Style) -->
            <section id="stories-container" class="flex gap-4 p-6 overflow-x-auto no-scrollbar bg-white border-b border-gray-200 mb-6">
                <!-- User Story (Always first) -->
                <div class="flex flex-col items-center gap-1 min-w-[80px]">
                    <div class="w-16 h-16 rounded-full story-gradient p-[2px] cursor-pointer" onclick="openCreateStoryModal()">
                        <div class="bg-white p-[2px] rounded-full w-full h-full relative">
                            <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100" class="rounded-full w-full h-full object-cover">
                            <div class="absolute bottom-0 right-0 bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center border-2 border-white text-[10px]">
                                <i class="fa-solid fa-plus"></i>
                            </div>
                        </div>
                    </div>
                    <span class="text-xs">Your Story</span>
                </div>
                <!-- Dynamic Stories will be injected here -->
            </section>

            <!-- Boards Grid (Pinterest Style) -->
            <section class="px-4 md:px-8 pb-20 max-w-7xl mx-auto">
                <div id="boards-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Boards injected here -->
                </div>
            </section>
        </div>

        <!-- ================= SINGLE BOARD VIEW (Instagram Feed Style) ================= -->
        <div id="board-view" class="hidden max-w-2xl mx-auto pt-8 pb-20">
            <div class="flex items-center justify-between mb-8 px-4">
                <button onclick="closeBoard()" class="text-2xl"><i class="fa-solid fa-arrow-left"></i></button>
                <h1 id="board-title" class="text-xl font-bold">Board Name</h1>
                <div class="flex items-center gap-4">
                    <button onclick="openCreatePinModal()" class="text-2xl hover:text-blue-500 transition"><i class="fa-solid fa-circle-plus"></i></button>
                    <div class="relative">
                        <button onclick="showDropdown(event, 'board-options-dropdown')"><i class="fa-solid fa-ellipsis"></i></button>
                        <div id="board-options-dropdown" class="dropdown-menu">
                            <button onclick="deleteCurrentBoard()" class="w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600 font-semibold">Delete board</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feed Container -->
            <div id="pins-container" class="flex flex-col gap-6">
                <!-- Instagram-style cards will be injected here -->
            </div>
        </div>

    </main>

    <!-- Create Board Modal -->
    <div id="create-board-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl relative">
            <h2 class="text-xl font-bold mb-4 text-center">New Board</h2>
            <input type="text" id="new-board-name" class="w-full bg-gray-100 rounded-lg p-3 mb-4 outline-none border border-gray-200" placeholder="Board Title">
            <button onclick="saveNewBoard()" class="w-full bg-blue-500 text-white font-bold py-2 rounded-lg hover:bg-blue-600 transition">Create</button>
            <button onclick="closeCreateBoardModal()" class="w-full mt-2 text-sm text-gray-500">Cancel</button>
        </div>
    </div>

    <!-- Create Story Modal -->
    <div id="create-story-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl relative">
            <h2 class="text-xl font-bold mb-4 text-center">Add Story</h2>
            <input type="text" id="new-story-img" class="w-full bg-gray-100 rounded-lg p-3 mb-4 outline-none border border-gray-200" placeholder="Story Image URL">
            <input type="text" id="new-story-user" class="w-full bg-gray-100 rounded-lg p-3 mb-4 outline-none border border-gray-200" placeholder="Username">
            <button onclick="saveNewStory()" class="w-full bg-gradient-to-tr from-yellow-400 to-purple-600 text-white font-bold py-2 rounded-lg transition">Post Story</button>
            <button onclick="closeCreateStoryModal()" class="w-full mt-2 text-sm text-gray-500">Cancel</button>
        </div>
    </div>

    <!-- Create Pin Modal -->
    <div id="create-pin-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl relative">
            <h2 class="text-xl font-bold mb-4 text-center">New Post</h2>
            <input type="text" id="new-pin-url" class="w-full bg-gray-100 rounded-lg p-3 mb-2 outline-none border border-gray-200" placeholder="Image URL">
            <input type="text" id="new-pin-user" class="w-full bg-gray-100 rounded-lg p-3 mb-2 outline-none border border-gray-200" placeholder="Username">
            <textarea id="new-pin-desc" class="w-full bg-gray-100 rounded-lg p-3 mb-4 outline-none border border-gray-200" placeholder="Description"></textarea>
            <button onclick="saveNewPin()" class="w-full bg-blue-500 text-white font-bold py-2 rounded-lg hover:bg-blue-600 transition">Post</button>
            <button onclick="closeCreatePinModal()" class="w-full mt-2 text-sm text-gray-500">Cancel</button>
        </div>
    </div>

    <script>
        let currentBoardIndex = null;

        // Initialize Data from LocalStorage or Defaults
        let boardsData = JSON.parse(localStorage.getItem('hybrid_boards')) || [
            { title: "Travel Vibes âœˆï¸", time: "2h", pins: [
                {url: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800", title: "Maldives", desc: "Clear waters and white sands.", user: "traveler_pro"},
                {url: "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=800", title: "Mountain High", desc: "Exploring the peaks.", user: "nature_lover"}
            ]},
            { title: "Design Portfolio", time: "5h", pins: [
                {url: "https://images.unsplash.com/photo-1558655146-d09347e92766?w=800", title: "UI Elements", desc: "Clean interfaces for 2024.", user: "designer_x"}
            ]},
            { title: "Food Art ðŸ•", time: "1d", pins: [
                {url: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=800", title: "Pizza Night", desc: "Best homemade dough recipe.", user: "chef_mario"}
            ]}
        ];

        let storiesData = JSON.parse(localStorage.getItem('hybrid_stories')) || [
            { user: "travel_guru", img: "https://i.pravatar.cc/100?u=1" },
            { user: "art_daily", img: "https://i.pravatar.cc/100?u=2" },
            { user: "tech_insider", img: "https://i.pravatar.cc/100?u=3" }
        ];

        function saveData() {
            localStorage.setItem('hybrid_boards', JSON.stringify(boardsData));
            localStorage.setItem('hybrid_stories', JSON.stringify(storiesData));
        }

        function showDropdown(event, id) {
            event.stopPropagation();
            hideAllDropdowns();
            document.getElementById(id).classList.add('active');
        }

        function hideAllDropdowns() {
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('active'));
        }

        // --- Render Functions ---

        function renderStories() {
            const container = document.getElementById('stories-container');
            // Keep the "Your Story" item
            const yourStory = container.firstElementChild.outerHTML;
            container.innerHTML = yourStory;

            storiesData.forEach(story => {
                container.innerHTML += `
                    <div class="flex flex-col items-center gap-1 min-w-[80px]">
                        <div class="w-16 h-16 rounded-full story-gradient p-[2px] cursor-pointer">
                            <div class="bg-white p-[2px] rounded-full w-full h-full">
                                <img src="${story.img}" class="rounded-full w-full h-full object-cover">
                            </div>
                        </div>
                        <span class="text-xs truncate w-full text-center">${story.user}</span>
                    </div>
                `;
            });
        }

        function renderBoards() {
            const grid = document.getElementById('boards-grid');
            grid.innerHTML = '';
            boardsData.forEach((board, index) => {
                const cover = board.pins[0]?.url || 'https://via.placeholder.com/400?text=Empty+Board';
                grid.innerHTML += `
                    <div class="cursor-pointer group relative bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200" onclick="openBoard(${index})">
                        <img src="${cover}" class="w-full aspect-square object-cover">
                        <div class="p-3">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-sm truncate">${board.title}</h3>
                                <div class="relative">
                                    <button onclick="showDropdown(event, 'drop-board-${index}')" class="text-gray-400 hover:text-black"><i class="fa-solid fa-ellipsis"></i></button>
                                    <div id="drop-board-${index}" class="dropdown-menu">
                                        <button onclick="deleteBoardByIndex(event, ${index})" class="w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600 text-sm font-semibold">Delete</button>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500">${board.pins.length} Posts</p>
                        </div>
                    </div>
                `;
            });
        }

        function openBoard(index) {
            currentBoardIndex = index;
            const board = boardsData[index];
            document.getElementById('board-title').innerText = board.title;
            
            const container = document.getElementById('pins-container');
            container.innerHTML = '';
            
            if (board.pins.length === 0) {
                container.innerHTML = `<div class="text-center py-20 text-gray-400"><i class="fa-solid fa-camera text-5xl mb-4 block"></i> No posts yet. Add your first Pin!</div>`;
            }

            board.pins.forEach((pin, pIdx) => {
                container.innerHTML += `
                    <div class="insta-card border border-gray-200 shadow-sm bg-white">
                        <!-- Post Header -->
                        <div class="flex items-center justify-between p-3">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 rounded-full overflow-hidden border border-gray-300">
                                    <img src="https://i.pravatar.cc/100?u=${pin.user}" class="w-full h-full object-cover">
                                </div>
                                <span class="font-bold text-sm">${pin.user}</span>
                            </div>
                            <div class="relative">
                                <button onclick="showDropdown(event, 'pin-opt-${pIdx}')"><i class="fa-solid fa-ellipsis"></i></button>
                                <div id="pin-opt-${pIdx}" class="dropdown-menu">
                                    <button onclick="deletePinByIndex(event, ${pIdx})" class="w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600 font-semibold text-sm">Delete Post</button>
                                </div>
                            </div>
                        </div>
                        <!-- Post Image -->
                        <img src="${pin.url}" class="w-full h-auto max-h-[600px] object-cover border-y border-gray-100">
                        <!-- Post Actions -->
                        <div class="p-3">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex gap-4 text-2xl">
                                    <i class="fa-regular fa-heart cursor-pointer hover:text-red-500 transition"></i>
                                    <i class="fa-regular fa-comment cursor-pointer"></i>
                                    <i class="fa-regular fa-paper-plane cursor-pointer"></i>
                                </div>
                                <i class="fa-regular fa-bookmark text-2xl cursor-pointer"></i>
                            </div>
                            <p class="text-sm font-bold mb-1">Liked by many people</p>
                            <p class="text-sm"><span class="font-bold">${pin.user}</span> ${pin.desc}</p>
                            <p class="text-[10px] text-gray-400 uppercase mt-2">${board.time || 'Just now'} ago</p>
                        </div>
                    </div>
                `;
            });

            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('board-view').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- Core Logic ---

        function closeBoard() {
            currentBoardIndex = null;
            document.getElementById('board-view').classList.add('hidden');
            document.getElementById('home-view').classList.remove('hidden');
            renderBoards();
        }

        // Modals Management
        function openCreateBoardModal() { document.getElementById('create-board-modal').classList.remove('hidden'); }
        function closeCreateBoardModal() { document.getElementById('create-board-modal').classList.add('hidden'); }
        
        function openCreateStoryModal() { document.getElementById('create-story-modal').classList.remove('hidden'); }
        function closeCreateStoryModal() { document.getElementById('create-story-modal').classList.add('hidden'); }

        function openCreatePinModal() { document.getElementById('create-pin-modal').classList.remove('hidden'); }
        function closeCreatePinModal() { document.getElementById('create-pin-modal').classList.add('hidden'); }

        // Save New Items
        function saveNewBoard() {
            const name = document.getElementById('new-board-name').value;
            if(name) {
                boardsData.unshift({title: name, time: "1m", pins: []});
                saveData();
                renderBoards();
                closeCreateBoardModal();
                document.getElementById('new-board-name').value = '';
            }
        }

        function saveNewStory() {
            const img = document.getElementById('new-story-img').value;
            const user = document.getElementById('new-story-user').value;
            if(img && user) {
                storiesData.unshift({user: user, img: img});
                saveData();
                renderStories();
                closeCreateStoryModal();
                document.getElementById('new-story-img').value = '';
                document.getElementById('new-story-user').value = '';
            }
        }

        function saveNewPin() {
            const url = document.getElementById('new-pin-url').value;
            const user = document.getElementById('new-pin-user').value;
            const desc = document.getElementById('new-pin-desc').value;
            if(url && user && currentBoardIndex !== null) {
                boardsData[currentBoardIndex].pins.unshift({
                    url: url,
                    user: user,
                    desc: desc,
                    title: "Untitled"
                });
                saveData();
                openBoard(currentBoardIndex);
                closeCreatePinModal();
                document.getElementById('new-pin-url').value = '';
                document.getElementById('new-pin-user').value = '';
                document.getElementById('new-pin-desc').value = '';
            }
        }

        // Delete Items
        function deleteBoardByIndex(event, index) {
            event.stopPropagation();
            boardsData.splice(index, 1);
            saveData();
            renderBoards();
        }

        function deleteCurrentBoard() {
            if (currentBoardIndex !== null) {
                boardsData.splice(currentBoardIndex, 1);
                saveData();
                closeBoard();
            }
        }

        function deletePinByIndex(event, pIdx) {
            event.stopPropagation();
            boardsData[currentBoardIndex].pins.splice(pIdx, 1);
            saveData();
            openBoard(currentBoardIndex);
        }

        // Initial Calls
        renderStories();
        renderBoards();
    </script>
</body>
</html>
